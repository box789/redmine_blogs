<div class="contextual">
<%= link_to_if_authorized l(:label_post_new),
                          { :controller => 'blogs',
                            :action => 'new',
                            :project_id => @project,
                            :global => true },
                          :class => 'icon icon-add',
                          :onclick => 'Element.show("add-blog"); return false;' %>
</div>

<div id="add-blog" style="display:none;">
<h2><%=l(:label_post_new)%></h2>
<%= labelled_form_for :blog, @blog, :url => { :controller => 'blogs', :action => 'new', :project_id => @project },
                                    :html => { :id => 'blog-form', 
                                               :class => nil,
                                               :multipart => true } do |f| %>
<%= render :partial => 'blogs/form', :locals => { :f => f } %>
<%= submit_tag l(:button_create) %>
<%= link_to_remote l(:label_preview),
                   { :url => { :controller => 'blogs', :action => 'preview' },
                     :method => 'post',
                     :update => 'preview',
                     :with => "Form.serialize('blog-form')" },
                   :accesskey => accesskey(:preview) %> |
<%= link_to l(:button_cancel), "#", :onclick => 'Element.hide("add-blog")' %>
<% end %>
<div id="preview" class="wiki"></div>
</div>

<h2><%=l(:label_blog_plural)%></h2>

<div class="splitcontentleft25">
  <% @blog_users = Blog.find(:all, :conditions => ["project_id = ?", @project]).collect{|b| b.author}.uniq.sort %>
  <% if @blog_users.any? %>
    <div class="box">
      <h3 class="icon22 icon22-users"><%=l(:label_users_blogs)%></h3>
    <table class="blogs list" width="300">
    <tbody>
      <% @blog_users.each do |user| %>
        <% if user.status == 1 %>
      <tr><td width="32"><%= avatar user, :size => 32 %></td><td><%= link_to h(user.name), :controller => 'blogs', :action => 'index', :id => user, :project_id => @project %></td></tr>
        <% end %>
      <% end %>
    </tbody>
    </table>
    </div>
  <% end %>
  <div class="box">
    <h3 class="icon22 icon22-tags"><%=l(:label_tag_cloud)%></h3>
    <%= render :partial => 'tag_cloud' %>
  </div>
</div>

<div class="splitcontentright75">
<%= render :partial => 'list', :locals => {:blogs => @blogs} %>
<p class="pagination"><%= pagination_links_full @blogs_pages %></p>

<% other_formats_links do |f| %>
  <%= f.link_to 'Atom', :url => { :action => 'index', :project_id => @project, :key => User.current.rss_key } %>
  <%= f.link_to 'RSS', :url => { :action => 'index', :project_id => @project, :key => User.current.rss_key } %>
<% end %>

</div>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'stylesheet', :plugin => 'redmine_blogs' %>
  <%= stylesheet_link_tag 'scm' %>
<% end %>

<% html_title(l(:label_blog_plural)) -%>
